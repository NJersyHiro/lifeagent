# Gmail認証エラーの修正方法

Gmail APIの認証エラーを修正しました。以下の手順で再認証してください：

## 手順

1. **開発サーバーを再起動**
   ```bash
   # Ctrl+C で現在のサーバーを停止
   npm run dev
   ```

2. **ブラウザで認証ページにアクセス**
   - http://localhost:3000/auth

3. **一度ログアウト**
   - 「ログアウト」ボタンをクリック

4. **再度ログイン**
   - 「Googleでログイン」ボタンをクリック
   - Googleアカウントを選択
   - **重要**: 権限の確認画面で「Gmail」と「送信」の権限を許可してください

## 修正内容

- トークンのリフレッシュ機能を実装
- `access_type: 'offline'` と `prompt: 'consent'` を追加してリフレッシュトークンを取得
- トークンの有効期限をチェックし、期限切れの場合は自動更新
- 認証エラー時の適切なエラーハンドリング

## トラブルシューティング

もし引き続きエラーが発生する場合：

1. ブラウザのクッキーとキャッシュをクリア
2. シークレット/プライベートウィンドウで試す
3. Google アカウントの「アプリとサービス」から一度アクセス権を削除してから再認証

## 確認方法

認証が成功したら：
- http://localhost:3000/auth ページで「アクセストークン: 取得済み」と表示される
- メール監視機能が正常に動作する